<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>মিষ্টি কুমড়া বট - প্রিমিয়াম এড</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style-pumpkin.css">
    <style>
        body {
            padding-bottom: 20px;
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
        }
        
        .premium-card {
            background: linear-gradient(135deg, #FFF3E0 0%, #FFECB3 100%);
            border: 2px solid #FFB74D;
            position: relative;
            overflow: hidden;
        }
        
        .premium-card::before {
            content: '⚡';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            opacity: 0.2;
        }
        
        .bolt-icon {
            animation: boltPulse 2s infinite;
        }
        
        @keyframes boltPulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .countdown-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #FF9800;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            color: #FF9800;
            margin: 0 auto;
        }
    </style>
</head>
<body class="font-sans">
    <div class="container mx-auto px-4 py-6">
        <!-- হেডার -->
        <div class="pumpkin-header mb-6 fade-in">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold">⚡ প্রিমিয়াম এড</h1>
                    <p class="text-white/80 text-sm">প্রিমিয়াম এড দেখে অতিরিক্ত আয় করুন</p>
                </div>
                <i class="fas fa-bolt text-2xl text-white/80 bolt-icon"></i>
            </div>
        </div>

        <!-- স্ট্যাটস -->
        <div class="pumpkin-card mb-6">
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="text-center">
                    <div class="text-2xl font-bold text-green-600 mb-1" id="todayEarnings">০.০০</div>
                    <div class="text-sm text-gray-600">আজকের আয়</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold text-orange-600 mb-1" id="adsWatched">০/৫০</div>
                    <div class="text-sm text-gray-600">এড দেখা</div>
                </div>
            </div>
            
            <!-- প্রোগ্রেস বার -->
            <div class="mb-4">
                <div class="flex justify-between text-sm mb-1">
                    <span class="text-gray-700 font-medium">আজকের লক্ষ্য</span>
                    <span class="font-bold text-orange-600" id="progressText">০%</span>
                </div>
                <div class="pumpkin-progress">
                    <div class="pumpkin-progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- প্রিমিয়াম এড সেকশন -->
        <div class="premium-card rounded-2xl p-6 mb-6">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-play-circle text-white text-2xl"></i>
                </div>
                <h2 class="text-xl font-bold mb-2">প্রিমিয়াম এড</h2>
                <div class="inline-block pumpkin-badge pumpkin-badge-green mb-2">
                    <i class="fas fa-coins mr-1"></i> ৭ টাকা/এড
                </div>
                <p class="text-gray-600 text-sm">একটি এড দেখে ৭ টাকা আয় করুন</p>
            </div>
            
            <!-- এড স্ট্যাটাস -->
            <div class="text-center mb-6">
                <div id="adStatus" class="inline-block px-4 py-2 rounded-full bg-green-50 text-green-600 font-medium mb-2">
                    <i class="fas fa-check-circle mr-2"></i>এড প্রস্তুত
                </div>
                <p class="text-sm text-gray-600" id="adStatusText">বাটনে ক্লিক করে এড দেখুন</p>
            </div>
            
            <!-- কাউন্টডাউন টাইমার -->
            <div class="text-center mb-6" id="countdownContainer" style="display: none;">
                <div class="countdown-circle mb-2" id="countdown">১০</div>
                <p class="text-gray-600 text-sm">এড চলছে... অপেক্ষা করুন</p>
            </div>
            
            <!-- প্রধান বাটন -->
            <button onclick="startBadDaoAd()" id="watchAdBtn" class="w-full pumpkin-btn bg-gradient-to-r from-yellow-500 to-orange-500 py-4 text-lg">
                <i class="fas fa-play mr-2"></i>
                <span id="btnText">প্রিমিয়াম এড দেখুন</span>
            </button>
            
            <!-- লোডিং এনিমেশন -->
            <div class="text-center mt-4" id="loadingAnimation" style="display: none;">
                <div class="inline-flex items-center">
                    <div class="pumpkin-spinner w-6 h-6 mr-2"></div>
                    <span class="text-gray-600">এড লোড হচ্ছে...</span>
                </div>
            </div>
        </div>

        <!-- তথ্য -->
        <div class="pumpkin-card">
            <h3 class="text-lg font-bold mb-4 text-gray-800">
                <i class="fas fa-info-circle text-orange-500 mr-2"></i>গুরুত্বপূর্ণ তথ্য
            </h3>
            <div class="space-y-3">
                <div class="flex items-start">
                    <i class="fas fa-check text-green-500 mt-1 mr-3"></i>
                    <p class="text-gray-700">প্রতি এড দেখে পাবেন <span class="font-bold text-green-600">৭ টাকা</span></p>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-check text-green-500 mt-1 mr-3"></i>
                    <p class="text-gray-700">প্রতিদিন <span class="font-bold">৫০টি</span> এড দেখা যাবে</p>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-check text-green-500 mt-1 mr-3"></i>
                    <p class="text-gray-700">এড দেখার পর ১০ সেকেন্ড অপেক্ষা করুন</p>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-check text-green-500 mt-1 mr-3"></i>
                    <p class="text-gray-700">পপআপ অন রাখুন এড দেখার জন্য</p>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-check text-green-500 mt-1 mr-3"></i>
                    <p class="text-gray-700">এড উইন্ডো স্বয়ংক্রিয় বন্ধ হবে না</p>
                </div>
            </div>
        </div>

        <!-- ব্যাক বাটন -->
        <a href="tasks-pumpkin.html" class="block w-full pumpkin-btn mt-6 bg-gradient-to-r from-gray-500 to-gray-600">
            <i class="fas fa-arrow-left mr-2"></i>টাস্ক পেজে ফিরে যান
        </a>
    </div>

<!-- Remove this line -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<!-- Add Firebase scripts and new app file -->
<script src="app-firebase-pumpkin.js"></script>
    <script>
        // বাডাও এড লিঙ্ক তালিকা
        const BAD_DAO_AD_LINKS = [
            "https://ferocitysuperintend.com/q3gtdwtif0?key=8fab9c833a59630b50874801fba88f73",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://adexora.my.id/dl/uDjmlB4uoO",
            "https://otieu.com/4/9809044",
            "https://otieu.com/4/10095617",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://otieu.com/4/9345167",
            "https://otieu.com/4/9569635",
            "https://otieu.com/4/10155431",
            "https://otieu.com/4/9550427",
            "https://ferocitysuperintend.com/img7n81xh8?key=60effca0c228e66afd204784027d8b16",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://otieu.com/4/9475514",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://otieu.com/4/10095617",
            "https://adexora.my.id/dl/SNIKX7EQosVmS22",
            "https://otieu.com/4/10095617",
            "https://otieu.com/4/10095617"
        ];

        // App State
        let appState = {
            isAdActive: false,
            todayBadDaoAds: 0,
            todayBadDaoEarnings: 0,
            adWindow: null,
            countdownInterval: null,
            currentCountdown: 10
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadBadDaoData();
        });

        // Load data from localStorage
        function loadBadDaoData() {
            const today = new Date().toDateString();
            
            // Load from localStorage
            const savedDate = localStorage.getItem('badDaoLastDate');
            const savedAds = localStorage.getItem('badDaoTodayAds');
            const savedEarnings = localStorage.getItem('badDaoTodayEarnings');
            
            // Check if date changed
            if (savedDate === today) {
                appState.todayBadDaoAds = parseInt(savedAds) || 0;
                appState.todayBadDaoEarnings = parseFloat(savedEarnings) || 0;
            } else {
                // Reset for new day
                appState.todayBadDaoAds = 0;
                appState.todayBadDaoEarnings = 0;
                localStorage.setItem('badDaoLastDate', today);
                localStorage.setItem('badDaoTodayAds', '0');
                localStorage.setItem('badDaoTodayEarnings', '0');
            }
            
            updateBadDaoUI();
        }

        // Save data to localStorage
        function saveBadDaoData() {
            localStorage.setItem('badDaoTodayAds', appState.todayBadDaoAds.toString());
            localStorage.setItem('badDaoTodayEarnings', appState.todayBadDaoEarnings.toString());
        }

        // Update UI
        function updateBadDaoUI() {
            document.getElementById('todayEarnings').textContent = appState.todayBadDaoEarnings.toFixed(2);
            document.getElementById('adsWatched').textContent = `${appState.todayBadDaoAds}/৫০`;
            
            const progress = (appState.todayBadDaoAds / 50) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${Math.round(progress)}%`;
            
            // Update button state
            const watchBtn = document.getElementById('watchAdBtn');
            if (appState.todayBadDaoAds >= 50) {
                watchBtn.disabled = true;
                watchBtn.innerHTML = '<i class="fas fa-check-circle mr-2"></i>আজকের লিমিট শেষ';
                document.getElementById('adStatus').innerHTML = '<i class="fas fa-ban mr-2"></i>লিমিট শেষ';
                document.getElementById('adStatus').className = 'inline-block px-4 py-2 rounded-full bg-red-50 text-red-600 font-medium mb-2';
                document.getElementById('adStatusText').textContent = 'আগামীকাল আবার চেষ্টা করুন';
            } else if (appState.isAdActive) {
                watchBtn.disabled = true;
                watchBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>এড চলছে...';
            } else {
                watchBtn.disabled = false;
                watchBtn.innerHTML = '<i class="fas fa-play mr-2"></i>প্রিমিয়াম এড দেখুন';
            }
        }

        // Start Bad Dao Ad
        async function startBadDaoAd() {
            if (appState.isAdActive || appState.todayBadDaoAds >= 50) return;
            
            const user = getUserData();
            if (!user) {
                alert('ডেটা লোড হয়নি। পেজ রিফ্রেশ করুন।');
                return;
            }
            
            appState.isAdActive = true;
            updateBadDaoUI();
            
            try {
                // Show loading
                showBadDaoLoading();
                
                // Open random ad
                await openBadDaoAd();
                
                // Start countdown
                startBadDaoCountdown();
                
                // After 10 seconds, give reward
                setTimeout(async () => {
                    await giveBadDaoReward();
                    finishBadDaoAd();
                }, 10000);
                
            } catch (error) {
                console.error('❌ Bad Dao Ad error:', error);
                showNotification('❌ এড লোড করতে সমস্যা হয়েছে। আবার চেষ্টা করুন।', 'error');
                resetBadDaoAd();
            }
        }

        // Open random Bad Dao Ad
        function openBadDaoAd() {
            return new Promise((resolve) => {
                const randomIndex = Math.floor(Math.random() * BAD_DAO_AD_LINKS.length);
                const selectedLink = BAD_DAO_AD_LINKS[randomIndex];
                
                document.getElementById('adStatus').innerHTML = '<i class="fas fa-external-link-alt mr-2"></i>এড খোলা হচ্ছে...';
                document.getElementById('adStatusText').textContent = 'প্রিমিয়াম এড লোড হচ্ছে...';
                
                // Open ad in new tab
                appState.adWindow = window.open(selectedLink, '_blank');
                
                if (!appState.adWindow) {
                    showNotification('⚠️ পপআপ ব্লক করা আছে! দয়া করে পপআপ অন করে আবার চেষ্টা করুন।', 'warning');
                    throw new Error('Popup blocked');
                }
                
                setTimeout(resolve, 1000);
            });
        }

        // Start countdown
        function startBadDaoCountdown() {
            const countdownContainer = document.getElementById('countdownContainer');
            const countdownElement = document.getElementById('countdown');
            
            countdownContainer.style.display = 'block';
            appState.currentCountdown = 10;
            countdownElement.textContent = appState.currentCountdown;
            
            appState.countdownInterval = setInterval(() => {
                appState.currentCountdown--;
                countdownElement.textContent = appState.currentCountdown;
                
                if (appState.currentCountdown <= 0) {
                    clearInterval(appState.countdownInterval);
                    countdownContainer.style.display = 'none';
                }
            }, 1000);
        }

        // Give reward (৭ টাকা)
        async function giveBadDaoReward() {
            const user = getUserData();
            if (!user) return;
            
            try {
                // Update counters
                appState.todayBadDaoAds++;
                appState.todayBadDaoEarnings += 7;
                
                // Save to localStorage
                saveBadDaoData();
                
                // Update in database
                await updateUserData({
                    balance: user.balance + 7,
                    total_income: (user.total_income || 0) + 7,
                    total_ads: (user.total_ads || 0) + 1
                });
                
                updateBadDaoUI();
                
                showNotification(`✅ সফল! ৭ টাকা যোগ হয়েছে। মোট আয়: ${appState.todayBadDaoEarnings.toFixed(2)} টাকা`, 'success');
                
            } catch (error) {
                console.error('❌ Error giving Bad Dao reward:', error);
                throw error;
            }
        }

        // Finish ad process
        function finishBadDaoAd() {
            document.getElementById('adStatus').innerHTML = '<i class="fas fa-check-circle mr-2"></i>এড সম্পূর্ণ';
            document.getElementById('adStatusText').textContent = '৭ টাকা আপনার ব্যালেন্সে যোগ হয়েছে!';
            
            setTimeout(() => {
                resetBadDaoAd();
            }, 2000);
        }

        // Reset ad process
        function resetBadDaoAd() {
            appState.isAdActive = false;
            
            if (appState.countdownInterval) {
                clearInterval(appState.countdownInterval);
                appState.countdownInterval = null;
            }
            
            document.getElementById('countdownContainer').style.display = 'none';
            document.getElementById('loadingAnimation').style.display = 'none';
            
            updateBadDaoUI();
        }

        // Show loading
        function showBadDaoLoading() {
            document.getElementById('loadingAnimation').style.display = 'block';
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadBadDaoData();
        });
    </script>
</body>
</html>