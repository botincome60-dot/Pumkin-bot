<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Æ‡¶ø‡¶∑‡ßç‡¶ü‡¶ø ‡¶ï‡ßÅ‡¶Æ‡ßú‡¶æ ‡¶¨‡¶ü - ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style-pumpkin.css">
    <style>
        body {
            padding-bottom: 80px !important;
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
        }
        
        .payment-method {
            transition: all 0.3s ease;
            border: 2px solid #E0E0E0;
        }
        
        .payment-method.active {
            border-color: #FF9800;
            background-color: #FFF3E0;
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.1);
        }
        
        .method-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            margin-bottom: 8px;
        }
        
        .bKash-icon {
            background: linear-gradient(135deg, #E2136E, #D30F64);
            color: white;
        }
        
        .Nagad-icon {
            background: linear-gradient(135deg, #F8A61C, #F79E1B);
            color: white;
        }
        
        .Rocket-icon {
            background: linear-gradient(135deg, #5D2D91, #4A1E7A);
            color: white;
        }
        
        .withdraw-status {
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            font-weight: 500;
        }
        
        .status-pending {
            background-color: #FFF3E0;
            border-left: 4px solid #FF9800;
            color: #FF9800;
        }
        
        .status-approved {
            background-color: #E8F5E9;
            border-left: 4px solid #4CAF50;
            color: #4CAF50;
        }
        
        .status-rejected {
            background-color: #FFEBEE;
            border-left: 4px solid #F44336;
            color: #F44336;
        }
    </style>
</head>
<body class="font-sans">
    <!-- ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶ì‡¶≠‡¶æ‡¶∞‡¶≤‡ßá -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="pumpkin-spinner"></div>
            <p class="text-gray-600 mt-4 text-lg">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>
    </div>

    <div class="container mx-auto px-4 py-6">
        <!-- ‡¶π‡ßá‡¶°‡¶æ‡¶∞ -->
        <div class="pumpkin-header mb-6 fade-in">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold">üí∞ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</h1>
                    <p class="text-white/80 text-sm">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡ßü ‡¶®‡¶ø‡¶® ‡¶∏‡¶π‡¶ú‡ßá</p>
                </div>
                <i class="fas fa-wallet text-2xl text-white/80"></i>
            </div>
        </div>

        <!-- ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡¶æ‡¶∞‡ßç‡¶° -->
        <div class="pumpkin-card mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-600 text-sm">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p>
                    <h2 class="text-3xl font-bold text-green-600" id="withdrawBalance">‡ß¶.‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</h2>
                </div>
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                    <i class="fas fa-coins text-green-600 text-xl"></i>
                </div>
            </div>
            
            <div class="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                <div class="flex items-start">
                    <i class="fas fa-info-circle text-yellow-500 mt-1 mr-2"></i>
                    <p class="text-sm text-yellow-700">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: <strong>‡ß´‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</strong></p>
                </div>
            </div>
        </div>

        <!-- ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ -->
        <div class="pumpkin-card mb-6">
            <h3 class="text-lg font-bold mb-4 text-gray-800">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            
            <!-- ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° -->
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-semibold mb-3">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                <div class="grid grid-cols-3 gap-3">
                    <button onclick="selectMethod('bkash')" id="bkashBtn" class="payment-method active rounded-xl p-4 text-center">
                        <div class="method-icon bKash-icon mx-auto">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <p class="font-semibold text-gray-800">bKash</p>
                        <p class="text-xs text-gray-500 mt-1">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</p>
                    </button>
                    
                    <button onclick="selectMethod('nagad')" id="nagadBtn" class="payment-method rounded-xl p-4 text-center">
                        <div class="method-icon Nagad-icon mx-auto">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <p class="font-semibold text-gray-800">Nagad</p>
                        <p class="text-xs text-gray-500 mt-1">‡¶®‡¶ó‡¶¶</p>
                    </button>
                    
                    <button onclick="selectMethod('rocket')" id="rocketBtn" class="payment-method rounded-xl p-4 text-center">
                        <div class="method-icon Rocket-icon mx-auto">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <p class="font-semibold text-gray-800">Rocket</p>
                        <p class="text-xs text-gray-500 mt-1">‡¶∞‡¶ï‡ßá‡¶ü</p>
                    </button>
                </div>
            </div>
            
            <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü -->
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-semibold mb-2">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶Æ‡¶æ‡¶â‡¶®‡ßç‡¶ü (‡¶ü‡¶æ‡¶ï‡¶æ‡ßü)</label>
                <input type="number" placeholder="500" id="withdrawAmount" min="500" 
                    class="w-full pumpkin-input text-lg font-semibold text-center">
                <p class="text-gray-500 text-xs mt-2">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: ‡ß´‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</p>
            </div>
            
            <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ -->
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-semibold mb-2" id="accountLabel">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ bKash ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞</label>
                <input type="text" placeholder="01XXXXXXXXX" id="accountNumber"
                    class="w-full pumpkin-input text-center">
                <p class="text-gray-500 text-xs mt-2">‡ßß‡ßß ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶®</p>
            </div>
            
            <button onclick="submitWithdraw()" id="withdrawBtn" class="w-full pumpkin-btn bg-gradient-to-r from-green-500 to-green-600">
                <i class="fas fa-paper-plane mr-2"></i>‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            
            <div id="withdrawStatus" class="mt-4 text-center text-sm" style="display: none;"></div>
        </div>

        <!-- ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡¶æ‡¶∞‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ö‡ßá‡¶ï -->
        <div class="pumpkin-card mb-6 bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200">
            <h3 class="text-lg font-bold mb-3 text-gray-800">‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶∂‡¶∞‡ßç‡¶§‡¶æ‡¶¨‡¶≤‡ßÄ</h3>
            <div class="space-y-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-users text-blue-500 mr-2"></i>
                        <span class="text-gray-700">‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤</span>
                    </div>
                    <span id="requirementReferrals" class="font-bold">‡ß¶/‡ßß‡ß´</span>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-eye text-blue-500 mr-2"></i>
                        <span class="text-gray-700">‡¶Æ‡ßã‡¶ü ‡¶è‡¶°</span>
                    </div>
                    <span id="requirementAds" class="font-bold">‡ß¶/‡ßß‡ß¶</span>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-money-bill text-blue-500 mr-2"></i>
                        <span class="text-gray-700">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶ü‡¶æ‡¶ï‡¶æ</span>
                    </div>
                    <span class="font-bold text-green-600">‡ß´‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</span>
                </div>
                
                <div class="mt-3 p-2 bg-white/50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-orange-500 mr-2"></i>
                        <span class="text-sm text-gray-600">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶Æ‡¶Ø‡¶º: ‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
        <div class="pumpkin-card bg-gradient-to-r from-green-100 to-emerald-100 border-green-200">
            <h3 class="text-lg font-bold mb-3 text-gray-800">‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶ï‡ßá ‡¶Ü‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <p class="text-gray-600 text-sm mb-4">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡ßß‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</p>
            
            <div class="bg-white/50 rounded-xl p-3 mb-4">
                <p class="text-gray-700 text-sm mb-1">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï</p>
                <div class="flex items-center">
                    <code class="text-sm font-mono flex-1 truncate bg-white/80 p-2 rounded-lg" id="supportReferralLink">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</code>
                    <button onclick="copySupportReferral()" class="ml-2 pumpkin-btn py-2 px-4 text-sm bg-gradient-to-r from-green-500 to-green-600">
                        <i class="fas fa-copy mr-1"></i> ‡¶ï‡¶™‡¶ø
                    </button>
                </div>
            </div>
            
            <div class="text-center">
                <p class="text-sm text-gray-600">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤: <span class="font-bold" id="referralCount">‡ß¶</span> ‡¶ú‡¶®</p>
            </div>
        </div>

        <!-- ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü -->
        <div class="pumpkin-card mt-6">
            <h3 class="text-lg font-bold mb-4 text-gray-800">‡¶∏‡¶π‡¶æ‡ßü‡¶§‡¶æ</h3>
            <div class="space-y-3">
                <a href="https://t.me/mishti_kumra_support" target="_blank" class="flex items-center p-3 border border-gray-200 rounded-xl hover:bg-gray-50 transition-colors">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                        <i class="fab fa-telegram text-blue-500"></i>
                    </div>
                    <div>
                        <p class="font-semibold">‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü</p>
                        <p class="text-gray-600 text-sm">@mishti_kumra_support</p>
                    </div>
                    <i class="fas fa-external-link-alt text-gray-400 ml-auto"></i>
                </a>
                
                <div class="p-3 border border-gray-200 rounded-xl">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-clock text-orange-500 mr-2"></i>
                        <p class="font-semibold">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡¶Æ‡¶Ø‡¶º</p>
                    </div>
                    <p class="text-gray-600 text-sm">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá</p>
                </div>
            </div>
        </div>

        <!-- ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø -->
        <div class="pumpkin-card mt-6" id="withdrawHistorySection" style="display: none;">
            <h3 class="text-lg font-bold mb-4 text-gray-800">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü</h3>
            <div id="withdrawHistory">
                <p class="text-gray-500 text-center py-4">‡¶ï‡ßã‡¶®‡ßã ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>
            </div>
        </div>
    </div>

    <!-- ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶¨‡¶æ‡¶∞ -->
    <div class="pumpkin-nav">
        <div class="grid grid-cols-4 gap-1 px-2 py-3">
            <a href="index.html" class="nav-item">
                <i class="fas fa-home nav-icon"></i>
                <span class="nav-label">‡¶π‡ßã‡¶Æ</span>
            </a>
            <a href="tasks-pumpkin.html" class="nav-item">
                <i class="fas fa-tasks nav-icon"></i>
                <span class="nav-label">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï</span>
            </a>
            <a href="support-pumpkin.html" class="nav-item active">
                <i class="fas fa-wallet nav-icon"></i>
                <span class="nav-label">‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞</span>
            </a>
            <a href="profile-pumpkin.html" class="nav-item">
                <i class="fas fa-user nav-icon"></i>
                <span class="nav-label">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span>
            </a>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>
    <script src="app-firebase-pumpkin.js"></script>

    <script>
        let selectedMethod = 'bkash';
        let userWithdrawHistory = [];

        // Initialize support page
        function initSupportPage() {
            updateSupportUI();
            updateRequirements();
            loadWithdrawHistory();
            hideLoading();
        }

        // Update support page UI
        function updateSupportUI() {
            const user = getUserData();
            if (user) {
                document.getElementById('withdrawBalance').textContent = user.balance.toFixed(2) + ' ‡¶ü‡¶æ‡¶ï‡¶æ';
                document.getElementById('supportReferralLink').textContent = generateShareableReferralLink();
                document.getElementById('referralCount').textContent = user.total_referrals || 0;
            }
        }

        // Update requirements display
        function updateRequirements() {
            const user = getUserData();
            if (user) {
                const referrals = user.total_referrals || 0;
                const ads = user.total_ads || 0;
                
                document.getElementById('requirementReferrals').textContent = `${referrals}/‡ßß‡ß´`;
                document.getElementById('requirementReferrals').className = referrals >= 15 ? 
                    'font-bold text-green-600' : 'font-bold text-red-600';
                
                document.getElementById('requirementAds').textContent = `${ads}/‡ßß‡ß¶`;
                document.getElementById('requirementAds').className = ads >= 10 ? 
                    'font-bold text-green-600' : 'font-bold text-red-600';
            }
        }

        // Select payment method
        function selectMethod(method) {
            selectedMethod = method;
            
            // Remove active class from all buttons
            document.querySelectorAll('.payment-method').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to selected button
            const selectedBtn = document.getElementById(method + 'Btn');
            selectedBtn.classList.add('active');
            
            // Update label
            const methodNames = {
                'bkash': 'bKash',
                'nagad': 'Nagad', 
                'rocket': 'Rocket'
            };
            document.getElementById('accountLabel').textContent = '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ' + methodNames[method] + ' ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞';
            document.getElementById('accountNumber').placeholder = '01XXXXXXXXX';
        }

        // Copy referral link
        function copySupportReferral() {
            copyReferralLink();
        }

        // Submit withdrawal request
        async function submitWithdraw() {
            const user = getUserData();
            if (!user) {
                alert('‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }

            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const accountNumber = document.getElementById('accountNumber').value.trim();

            // Validate amount
            if (!amount || amount < 500) {
                showNotification('‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ß´‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá!', 'error');
                return;
            }

            // Validate account number
            if (!accountNumber || accountNumber.length !== 11 || !accountNumber.startsWith('01')) {
                showNotification('‡¶∏‡¶†‡¶ø‡¶ï ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶¶‡¶ø‡¶® (‡ßß‡ßß ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü, 01 ‡¶¶‡¶ø‡ßü‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ)!', 'error');
                return;
            }

            // Check balance
            if (amount > user.balance) {
                showNotification(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ö‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§!\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ${user.balance.toFixed(2)} ‡¶ü‡¶æ‡¶ï‡¶æ`, 'error');
                return;
            }

            // Check referral requirement
            if (user.total_referrals < 15) {
                showNotification(
                    `‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®!\n\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤: ${user.total_referrals} ‡¶ú‡¶®\n‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®: ‡ßß‡ß´ ‡¶ú‡¶®\n\n‡¶Ü‡¶∞‡¶ì ${15 - user.total_referrals} ‡¶ú‡¶® ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§`,
                    'error'
                );
                return;
            }

            // Check AD requirement
            if (user.total_ads < 10) {
                showNotification(
                    `‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®!\n\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶è‡¶°: ${user.total_ads} ‡¶ü‡¶ø\n‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®: ‡ßß‡ß¶ ‡¶ü‡¶ø\n\n‡¶Ü‡¶∞‡¶ì ${10 - user.total_ads} ‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®‡•§`,
                    'error'
                );
                return;
            }

            // Process withdrawal
            await processWithdrawRequest(amount, accountNumber);
        }

        // Process withdrawal request
        async function processWithdrawRequest(amount, accountNumber) {
            const user = getUserData();
            
            try {
                // Show loading
                const withdrawBtn = document.getElementById('withdrawBtn');
                withdrawBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
                withdrawBtn.disabled = true;

                // Deduct balance from user
                await updateUserData({
                    balance: user.balance - amount
                });

                // Save withdraw request to Firebase
                await saveWithdrawToFirebase(amount, accountNumber, selectedMethod);

                // Success message
                showNotification(
                    `‚úÖ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤!\n\n` +
                    `‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: ${amount} ‡¶ü‡¶æ‡¶ï‡¶æ\n` +
                    `${getMethodName(selectedMethod)}: ${accountNumber}\n\n` +
                    `‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§`,
                    'success'
                );

                // Reset form
                document.getElementById('withdrawAmount').value = '';
                document.getElementById('accountNumber').value = '';
                
                // Update balance display
                document.getElementById('withdrawBalance').textContent = (user.balance - amount).toFixed(2) + ' ‡¶ü‡¶æ‡¶ï‡¶æ';
                
                // Reload withdrawal history
                await loadWithdrawHistory();

            } catch (error) {
                console.error('Withdraw error:', error);
                showNotification('‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•! ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
            } finally {
                // Reset button
                const withdrawBtn = document.getElementById('withdrawBtn');
                withdrawBtn.innerHTML = '<i class="fas fa-paper-plane mr-2"></i>‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®';
                withdrawBtn.disabled = false;
            }
        }

        // Get method name
        function getMethodName(method) {
            const methodNames = {
                'bkash': 'bKash',
                'nagad': 'Nagad',
                'rocket': 'Rocket'
            };
            return methodNames[method] || method;
        }

        // Load withdrawal history from Firebase
        async function loadWithdrawHistory() {
            try {
                const user = getUserData();
                if (!user || !window.db) return;
                
                const withdrawHistorySection = document.getElementById('withdrawHistorySection');
                const withdrawHistoryDiv = document.getElementById('withdrawHistory');
                
                // Fetch withdrawals from Firebase
                const querySnapshot = await window.db.collection('withdrawals')
                    .where('user_id', '==', user.id)
                    .orderBy('requested_at', 'desc')
                    .limit(10)
                    .get();
                
                userWithdrawHistory = [];
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    data.id = doc.id;
                    userWithdrawHistory.push(data);
                });
                
                if (userWithdrawHistory.length > 0) {
                    withdrawHistorySection.style.display = 'block';
                    withdrawHistoryDiv.innerHTML = '';
                    
                    userWithdrawHistory.forEach(withdrawal => {
                        const withdrawItem = createWithdrawHistoryItem(withdrawal);
                        withdrawHistoryDiv.appendChild(withdrawItem);
                    });
                } else {
                    withdrawHistorySection.style.display = 'block';
                    withdrawHistoryDiv.innerHTML = '<p class="text-gray-500 text-center py-4">‡¶ï‡ßã‡¶®‡ßã ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø</p>';
                }
                
            } catch (error) {
                console.error('Error loading withdrawal history:', error);
            }
        }

        // Create withdrawal history item
        function createWithdrawHistoryItem(withdrawal) {
            const div = document.createElement('div');
            div.className = 'withdraw-item mb-3 p-3 border border-gray-200 rounded-lg';
            
            // Format date
            let requestDate = '‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø';
            if (withdrawal.requested_at && withdrawal.requested_at.toDate) {
                const date = withdrawal.requested_at.toDate();
                requestDate = date.toLocaleDateString('bn-BD', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            // Status badge
            let statusClass = 'status-pending';
            let statusText = '‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç';
            let statusIcon = 'fas fa-clock';
            
            if (withdrawal.status === 'approved') {
                statusClass = 'status-approved';
                statusText = '‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§';
                statusIcon = 'fas fa-check-circle';
            } else if (withdrawal.status === 'rejected') {
                statusClass = 'status-rejected';
                statusText = '‡¶¨‡¶æ‡¶§‡¶ø‡¶≤';
                statusIcon = 'fas fa-times-circle';
            } else if (withdrawal.status === 'paid') {
                statusClass = 'status-approved';
                statusText = '‡¶™‡ßá‡¶á‡¶°';
                statusIcon = 'fas fa-check-double';
            }
            
            div.innerHTML = `
                <div class="flex justify-between items-center mb-2">
                    <div class="flex items-center">
                        <i class="fas fa-${withdrawal.method === 'bkash' ? 'mobile-alt' : withdrawal.method === 'nagad' ? 'wallet' : 'rocket'} text-${withdrawal.method === 'bkash' ? 'pink' : withdrawal.method === 'nagad' ? 'orange' : 'purple'}-500 mr-2"></i>
                        <span class="font-semibold">${getMethodName(withdrawal.method)}</span>
                    </div>
                    <div class="${statusClass} px-3 py-1 rounded-full text-xs">
                        <i class="${statusIcon} mr-1"></i>${statusText}
                    </div>
                </div>
                
                <div class="flex justify-between mb-1">
                    <span class="text-gray-600 text-sm">‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£:</span>
                    <span class="font-bold">${withdrawal.amount} ‡¶ü‡¶æ‡¶ï‡¶æ</span>
                </div>
                
                <div class="flex justify-between mb-1">
                    <span class="text-gray-600 text-sm">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü:</span>
                    <span class="font-mono">${withdrawal.account_number}</span>
                </div>
                
                <div class="flex justify-between">
                    <span class="text-gray-600 text-sm">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</span>
                    <span class="text-gray-500 text-sm">${requestDate}</span>
                </div>
                
                ${withdrawal.transaction_id ? `
                <div class="mt-2 text-xs text-gray-500">
                    <i class="fas fa-receipt mr-1"></i>
                    ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶®: ${withdrawal.transaction_id}
                </div>
                ` : ''}
            `;
            
            return div;
        }

        // Check requirements periodically
        setInterval(updateRequirements, 30000);

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initSupportPage, 1000);
        });
    </script>
</body>
</html>