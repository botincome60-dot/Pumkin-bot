<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Æ‡¶ø‡¶∑‡ßç‡¶ü‡¶ø ‡¶ï‡ßÅ‡¶Æ‡ßú‡¶æ ‡¶¨‡¶ü - ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style-pumpkin.css">
    <style>
        body {
            padding-bottom: 20px;
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
        }
        
        .countdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
        }
        
        .countdown-number {
            font-size: 80px;
            font-weight: bold;
            color: #FF9800;
            text-shadow: 0 0 20px rgba(255, 152, 0, 0.5);
            margin: 20px 0;
        }
        
        .ad-window {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="font-sans">
    <!-- ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶ì‡¶≠‡¶æ‡¶∞‡¶≤‡ßá -->
    <div id="loadingOverlay" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
        <div class="text-center">
            <div class="pumpkin-spinner"></div>
            <p class="text-gray-600 mt-4 text-lg">‡¶è‡¶° ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
        </div>
    </div>

    <!-- ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶°‡¶æ‡¶â‡¶® ‡¶ì‡¶≠‡¶æ‡¶∞‡¶≤‡ßá -->
    <div id="countdownOverlay" class="countdown-overlay">
        <div class="text-center">
            <i class="fas fa-clock text-white text-4xl mb-4"></i>
            <div id="countdownText" class="text-white text-xl mb-2">‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</div>
            <div id="countdownNumber" class="countdown-number">‡ßß‡ß¶</div>
            <div id="redirectNotice" class="text-gray-300 mt-4">‡¶è‡¶°‡¶ü‡¶ø ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶¨‡ßá</div>
            <div class="text-yellow-300 mt-6 text-sm">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶° ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-6">
        <!-- ‡¶π‡ßá‡¶°‡¶æ‡¶∞ -->
        <div class="pumpkin-header mb-6 fade-in">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold">üì∫ ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</h1>
                    <p class="text-white/80 text-sm">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶Ü‡ßü ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                </div>
                <i class="fas fa-play-circle text-2xl text-white/80"></i>
            </div>
        </div>

        <!-- ‡¶è‡¶° ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞ -->
        <div class="pumpkin-card mb-6 text-center">
            <div class="mb-4">
                <h3 class="text-lg font-bold mb-2">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶è‡¶° ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü</h3>
                <div class="text-4xl font-bold text-orange-600" id="adsCounter">‡ß¶/‡ßß‡ß¶</div>
                <p class="text-gray-500 text-sm mt-2" id="resetTimer">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡ßü ‡ßß‡ß¶‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</p>
            </div>
            
            <div class="mb-4">
                <div class="flex justify-between text-sm mb-1">
                    <span>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶ó‡ßç‡¶∞‡ßá‡¶∏</span>
                    <span id="adsProgressText">‡ß¶%</span>
                </div>
                <div class="pumpkin-progress">
                    <div class="pumpkin-progress-fill" id="progressBar" style="width: 0%"></div>
                </div>
            </div>
            
            <div class="p-3 bg-orange-50 rounded-lg">
                <p class="text-sm text-orange-700">
                    <i class="fas fa-info-circle mr-1"></i>
                    ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶® <strong>‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</strong>
                </p>
            </div>
        </div>

        <!-- ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶è‡¶∞‡¶ø‡ßü‡¶æ -->
        <div class="pumpkin-card mb-6 ad-window">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-ad text-orange-600 text-2xl"></i>
                </div>
                <h3 class="text-xl font-bold mb-2">‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶° ‡¶è‡¶°</h3>
                <p class="text-gray-600">‡¶è‡¶á ‡¶è‡¶°‡¶ü‡¶ø ‡¶¶‡ßá‡¶ñ‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶®</p>
                <div class="text-3xl font-bold text-green-600 mt-2">‡ß©‡ß¶.‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ</div>
            </div>
            
            <!-- ‡¶è‡¶° ‡¶ï‡¶®‡ßç‡¶ü‡ßá‡¶®‡ßç‡¶ü -->
            <div class="bg-gradient-to-r from-orange-50 to-yellow-50 border border-orange-200 rounded-xl p-5 text-center mb-6">
                <h4 class="font-bold text-lg mb-3">üé¨ ‡¶∞‡¶ø‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°‡ßá‡¶° ‡¶è‡¶°</h4>
                <p class="text-gray-600 mb-4">‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                
                <div class="bg-white p-4 rounded-lg border border-orange-300 mb-4">
                    <i class="fas fa-play-circle text-orange-500 text-4xl mb-3"></i>
                    <p class="text-sm text-gray-500">‡¶è‡¶ï‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    <p class="text-xs text-gray-400 mt-3" id="adStatus">‡¶è‡¶° ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§</p>
                </div>
            </div>
            
            <!-- ‡¶¨‡¶æ‡¶ü‡¶® -->
            <button onclick="showAd()" id="watchAdBtn" class="w-full pumpkin-btn bg-gradient-to-r from-green-500 to-green-600 py-4 text-lg">
                <i class="fas fa-play mr-2"></i>
                ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
            </button>
            
            <div class="text-center mt-4">
                <p class="text-gray-500 text-sm" id="rewardStatus">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá</p>
                <p class="text-xs text-gray-400 mt-2" id="countdownInfo"></p>
            </div>
        </div>

        <!-- ‡¶§‡¶•‡ßç‡¶Ø -->
        <div class="pumpkin-card bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-200">
            <div class="flex items-start">
                <div class="w-10 h-10 bg-yellow-100 rounded-full flex items-center justify-center mr-3">
                    <i class="fas fa-info-circle text-yellow-500"></i>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-800 mb-2">‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶§‡¶•‡ßç‡¶Ø</h4>
                    <div class="space-y-2">
                        <div class="flex items-start">
                            <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
                            <p class="text-gray-600 text-sm">‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞ ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ö‡¶ü‡ßã ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá</p>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
                            <p class="text-gray-600 text-sm">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡ßü ‡ßß‡ß¶‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®</p>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
                            <p class="text-gray-600 text-sm">‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶è‡¶° ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶π‡¶¨‡ßá</p>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check text-green-500 mt-1 mr-2"></i>
                            <p class="text-gray-600 text-sm">‡¶è‡¶° ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶®‡¶ø‡¶ú‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶¨‡ßá‡¶®</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¨‡¶æ‡¶ü‡¶® -->
        <a href="tasks-pumpkin.html" class="block w-full pumpkin-btn mt-6 bg-gradient-to-r from-gray-500 to-gray-600">
            <i class="fas fa-arrow-left mr-2"></i>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶™‡ßá‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®
        </a>
    </div>

    <!-- ‡¶∏‡¶æ‡¶™‡¶æ‡¶¨‡ßá‡¶∏ SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="app-supabase-pumpkin.js"></script>

    <script>
        // ‡¶è‡¶° ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ
        const AD_LINKS = [
            "https://ferocitysuperintend.com/q3gtdwtif0?key=8fab9c833a59630b50874801fba88f73",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://otieu.com/4/9809044",
            "https://otieu.com/4/10095617",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://ferocitysuperintend.com/wzvdzr4ka?key=7a422407e8fedbc108da1c1da906f0a9",
            "https://otieu.com/4/9345167",
            "https://otieu.com/4/9569635",
            "https://otieu.com/4/10155431",
            "https://otieu.com/4/9550427",
            "https://ferocitysuperintend.com/img7n81xh8?key=60effca0c228e66afd204784027d8b16",
            "https://otieu.com/4/9475514",
            "https://adexora.my.id/dl/SNIKX7EQosVmS22",
            "https://otieu.com/4/10095617"
        ];

        let isAdLoading = false;
        let adWindow = null;
        let countdownInterval;
        let currentCountdown = 10;

        function initAdsPage() {
            updateUI();
            updateResetTimer();
            hideLoading();
        }

        function updateUI() {
            const user = getUserData();
            if (user) {
                document.getElementById('adsCounter').textContent = `${user.today_ads}/‡ßß‡ß¶`;
                const progress = (user.today_ads / 10) * 100;
                document.getElementById('progressBar').style.width = `${progress}%`;
                document.getElementById('adsProgressText').textContent = `${Math.round(progress)}%`;
                
                // Check if user can watch more ads
                if (!canWatchMoreAds()) {
                    document.getElementById('watchAdBtn').disabled = true;
                    document.getElementById('watchAdBtn').innerHTML = '<i class="fas fa-clock mr-2"></i>‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑';
                    document.getElementById('watchAdBtn').classList.add('bg-gray-400');
                    document.getElementById('watchAdBtn').classList.remove('from-green-500', 'to-green-600');
                    document.getElementById('adStatus').textContent = '‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑';
                    document.getElementById('adStatus').className = 'text-xs text-red-600';
                } else {
                    document.getElementById('watchAdBtn').disabled = false;
                    document.getElementById('watchAdBtn').innerHTML = '<i class="fas fa-play mr-2"></i>‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
                    document.getElementById('watchAdBtn').classList.remove('bg-gray-400');
                    document.getElementById('watchAdBtn').classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600');
                }
            }
        }

        function updateResetTimer() {
            const resetTimer = document.getElementById('resetTimer');
            const timeUntilReset = getTimeUntilNextReset();
            resetTimer.textContent = `‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡ßü ‡ßß‡ß¶‡¶ü‡¶ø ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® (‡¶∞‡¶ø‡¶∏‡ßá‡¶ü: ${timeUntilReset})`;
        }

        async function showAd() {
            const user = getUserData();
            if (!user) {
                alert('‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡ßü‡¶®‡¶ø‡•§ ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }

            if (!canWatchMoreAds()) {
                alert(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶° ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑! ${getTimeUntilNextReset()} ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`);
                return;
            }

            if (isAdLoading) {
                return;
            }

            isAdLoading = true;
            const watchBtn = document.getElementById('watchAdBtn');
            watchBtn.disabled = true;
            watchBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
            document.getElementById('adStatus').textContent = '‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
            document.getElementById('adStatus').className = 'text-xs text-yellow-600';

            try {
                // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶è‡¶° ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶Ø‡¶¶‡¶ø ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶•‡¶æ‡¶ï‡ßá)
                if (adWindow && !adWindow.closed) {
                    adWindow.close();
                }
                
                await showAdLink();
                
            } catch (error) {
                console.error('‚ùå ‡¶è‡¶° ‡¶è‡¶∞‡¶∞:', error);
                document.getElementById('adStatus').textContent = '‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ - ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
                document.getElementById('adStatus').className = 'text-xs text-red-600';
                
                alert('‡¶è‡¶° ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                
                resetAdButton();
                isAdLoading = false;
            }
        }

        // Random ad link function
        function showAdLink() {
            return new Promise((resolve) => {
                document.getElementById('adStatus').textContent = '‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá... ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®';
                document.getElementById('adStatus').className = 'text-xs text-blue-600';
                
                const watchBtn = document.getElementById('watchAdBtn');
                watchBtn.innerHTML = '<i class="fas fa-eye mr-2"></i>‡¶è‡¶° ‡¶ö‡¶≤‡¶õ‡ßá...';
                
                // Randomly select a link
                const randomIndex = Math.floor(Math.random() * AD_LINKS.length);
                const selectedLink = AD_LINKS[randomIndex];
                
                console.log(`Selected ad index: ${randomIndex}, Link: ${selectedLink}`);
                
                // Open the link in new tab - WITHOUT auto-closing
                adWindow = window.open(selectedLink, '_blank', 'width=800,height=600');
                
                if (!adWindow) {
                    alert('‡¶™‡¶™‡¶Ü‡¶™ ‡¶¨‡ßç‡¶≤‡¶ï‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡ßá‡¶¨‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®! ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶™‡¶Ü‡¶™ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶â ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§');
                    resetAdButton();
                    isAdLoading = false;
                    resolve();
                    return;
                }
                
                // Focus back to main window after a short delay
                setTimeout(() => {
                    if (window.focus) window.focus();
                }, 500);
                
                // Show countdown overlay
                showCountdownOverlay();
                
                // Simulate ad watching for 10 seconds only
                setTimeout(async () => {
                    try {
                        await rewardUserForAd();
                        
                        // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶¨‡ßã ‡¶®‡¶æ - ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ ‡¶®‡¶ø‡¶ú‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡¶¨‡ßá
                        document.getElementById('adStatus').textContent = '‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡ßÇ‡¶∞‡ßç‡¶£! ‡¶è‡¶° ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶®‡¶ø‡¶ú‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®';
                        document.getElementById('adStatus').className = 'text-xs text-green-600';
                        
                    } finally {
                        hideCountdownOverlay();
                        resolve();
                    }
                }, 10000); // ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°
            });
        }

        function showCountdownOverlay() {
            const overlay = document.getElementById('countdownOverlay');
            const countdownNumber = document.getElementById('countdownNumber');
            const countdownText = document.getElementById('countdownText');
            
            overlay.style.display = 'flex';
            currentCountdown = 10;
            countdownNumber.textContent = currentCountdown;
            countdownText.textContent = '‡¶è‡¶°‡¶ü‡¶ø ‡¶ñ‡ßã‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!';
            
            countdownInterval = setInterval(() => {
                currentCountdown--;
                countdownNumber.textContent = currentCountdown;
                
                if (currentCountdown <= 0) {
                    clearInterval(countdownInterval);
                }
            }, 1000);
        }

        function hideCountdownOverlay() {
            const overlay = document.getElementById('countdownOverlay');
            overlay.style.display = 'none';
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
        }

        async function rewardUserForAd() {
            const user = getUserData();
            if (!user) return;
            
            try {
                let todayAds = user.today_ads || 0;
                let lastAdReset = user.last_ad_reset || user.join_date;
                const lastResetTime = new Date(lastAdReset);
                const now = new Date();
                const hoursDiff = (now - lastResetTime) / (1000 * 60 * 60);
                
                console.log("Current ads:", todayAds, "Hours diff:", hoursDiff);
                
                // Reset if 1 hour has passed since last reset
                if (hoursDiff >= 1) {
                    todayAds = 0;
                    lastAdReset = now.toISOString();
                    console.log("Resetting counter due to time passed");
                }
                
                // Check if user has reached limit
                if (todayAds >= 10) {
                    alert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶° ‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶∂‡ßá‡¶∑ ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡ßß ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ‡¶™‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                    resetAdButton();
                    isAdLoading = false;
                    return;
                }
                
                // Add reward and update ads count
                const newAdCount = todayAds + 1;
                console.log("Updating ads count to:", newAdCount);
                
                await updateUserData({ 
                    balance: user.balance + 30,
                    total_income: (user.total_income || 0) + 30,
                    today_ads: newAdCount,
                    last_ad_reset: lastAdReset
                });
                
                // Update UI
                updateUI();
                updateResetTimer();
                
                // Success message
                document.getElementById('rewardStatus').textContent = '‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!';
                document.getElementById('rewardStatus').className = 'text-sm text-green-600 font-semibold';
                
                const watchBtn = document.getElementById('watchAdBtn');
                watchBtn.innerHTML = '<i class="fas fa-check mr-2"></i>‡¶∏‡¶´‡¶≤! ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá';
                watchBtn.classList.remove('from-green-500', 'to-green-600');
                watchBtn.classList.add('bg-green-500');
                
                showNotification('üéâ ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§\n‡¶è‡¶° ‡¶â‡¶á‡¶®‡ßç‡¶°‡ßã ‡¶®‡¶ø‡¶ú‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'success');
                
                // Reset button after 3 seconds
                setTimeout(() => {
                    if (canWatchMoreAds()) {
                        resetAdButton();
                    }
                    isAdLoading = false;
                }, 3000);
                
            } catch (error) {
                console.error('‚ùå Error rewarding user for ad:', error);
                document.getElementById('adStatus').textContent = '‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá';
                document.getElementById('adStatus').className = 'text-xs text-red-600';
                throw error;
            }
        }

        function resetAdButton() {
            if (canWatchMoreAds()) {
                const watchBtn = document.getElementById('watchAdBtn');
                watchBtn.innerHTML = '<i class="fas fa-play mr-2"></i>‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
                watchBtn.classList.remove('bg-green-500');
                watchBtn.classList.add('bg-gradient-to-r', 'from-green-500', 'to-green-600');
                watchBtn.disabled = false;
                document.getElementById('adStatus').textContent = '‡¶è‡¶° ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§';
                document.getElementById('adStatus').className = 'text-xs text-green-600';
                document.getElementById('rewardStatus').textContent = '‡¶è‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡ß©‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá';
                document.getElementById('rewardStatus').className = 'text-gray-500 text-sm';
            }
        }

        // Update reset timer every 30 seconds
        setInterval(updateResetTimer, 30000);
        
        // Check for reset every minute
        setInterval(() => {
            const user = getUserData();
            if (user) {
                updateUI();
            }
        }, 60000);

        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initAdsPage, 1000);
        });
    </script>
</body>
</html>